
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>讨论一下类似BlogEngine为何要一次性加载所有Post到内存 - 武眉博</title>
  <meta name="author" content="Marble Wu">

  
  <meta name="description" content="试验了一下给BlogEngine生成10000个post 程序第一次运行时等待的时间让我想自杀（白屏了近2分钟)看了一下代码，发现BlogEngine在第一次运行时候加载所有Post（从数据库)到List内,类似（Early initialization）当新添加post时，给数据库（xml/ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://huobazi.github.com/blog/2007/07/04/lazyinitializationorearlyinitializationinblogengine/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="武眉博" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-56321-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">武眉博</a></h1>
  
    <h2>Marble's blog.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:huobazi.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/links">Friends</a></li>
  <li><a href="/about">About</a></li>
  
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">讨论一下类似BlogEngine为何要一次性加载所有Post到内存</h1>
    
    
      <p class="meta">
        








  


<time datetime="2007-07-04T13:13:00+08:00" pubdate data-updated="true">Jul 4<span>th</span>, 2007</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>试验了一下给BlogEngine生成10000个post 程序第一次运行时等待的时间让我想自杀（白屏了近2分钟)<br />看了一下代码，发现BlogEngine在第一次运行时候加载所有Post（从数据库)到List内,类似（Early initialization）<br />当新添加post时，给数据库（xml/database)内加入该post同时给List内追加该post<br />删除一个post时候从数据库（xml/database)内删除并从List内remove该post</p>


<div style="padding-right: 5px; padding-left: 4px; font-size: 13px; padding-bottom: 4px; width: 98%; word-break: break-all; padding-top: 4px; background-color: #eeeeee; border: #cccccc 1px solid;">
<span style="COLOR: #008080">  1</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">  2</span><span style="COLOR: #0000ff">private</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> _Content;<br /></span><span style="COLOR: #008080">  3</span><span id="Codehighlighter1_26_96_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff">/**/</span><span id="Codehighlighter1_26_96_Open_Text"><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;summary&gt;</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">  4</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> Gets or sets the Content or the post.<br /></span><span style="COLOR: #008080">  5</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;/summary&gt;</span></span><br /><span style="COLOR: #008080">  6</span><span style="COLOR: #0000ff">public</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> Content<br /></span><span style="COLOR: #008080">  7</span><span id="Codehighlighter1_119_341_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">  8</span><span style="COLOR: #000000">  </span><span style="COLOR: #0000ff">get</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">  9</span><span style="COLOR: #000000">  </span><span id="Codehighlighter1_129_243_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 10</span><span style="COLOR: #000000">      </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000"> ( _Content </span><span style="COLOR: #000000">==</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000"> )<br /></span><span style="COLOR: #008080"> 11</span><span style="COLOR: #000000">      </span><span id="Codehighlighter1_167_216_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 12</span><span style="COLOR: #000000">        _Content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> LoadPostContent( </span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000">.Id );<br /></span><span style="COLOR: #008080"> 13</span><span style="COLOR: #000000">      }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 14</span><span style="COLOR: #000000">      </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> _Content;<br /></span><span style="COLOR: #008080"> 15</span><span style="COLOR: #000000">  }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 16</span><span style="COLOR: #000000">  </span><span style="COLOR: #0000ff">set</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 17</span><span style="COLOR: #000000">  </span><span id="Codehighlighter1_253_339_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 18</span><span style="COLOR: #000000">      </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000"> ( _Content </span><span style="COLOR: #000000">!=</span><span style="COLOR: #000000"> value )<br /></span><span style="COLOR: #008080"> 19</span><span style="COLOR: #000000">      MarkDirty( </span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">Content</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000"> );<br /></span><span style="COLOR: #008080"> 20</span><span style="COLOR: #000000">      _Content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> value;<br /></span><span style="COLOR: #008080"> 21</span><span style="COLOR: #000000">  }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 22</span><span style="COLOR: #000000">}</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 23</span><span style="COLOR: #0000ff">private</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> LoadPostContent(Guid id)<br /></span><span style="COLOR: #008080"> 24</span><span id="Codehighlighter1_383_913_Open_Text"><span style="COLOR: #000000">{    <br /></span><span style="COLOR: #008080"> 25</span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">;<br /></span><span style="COLOR: #008080"> 26</span><span style="COLOR: #000000">    <br /></span><span style="COLOR: #008080"> 27</span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> key </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000">.Format(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">Be:Content:{0}</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">,id);<br /></span><span style="COLOR: #008080"> 28</span><span style="COLOR: #000000">    <br /></span><span style="COLOR: #008080"> 29</span><span style="COLOR: #000000">    </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> if there is no content cached</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 30</span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">object</span><span style="COLOR: #000000"> obj </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> HttpContext.Current.Cache.Get(key);<br /></span><span style="COLOR: #008080"> 31</span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">(obj </span><span style="COLOR: #000000">==</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">)<br /></span><span style="COLOR: #008080"> 32</span><span style="COLOR: #000000">    </span><span id="Codehighlighter1_566_910_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 33</span><span style="COLOR: #000000">        </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> load the post&#8217;s content from provider here</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 34</span><span style="COLOR: #000000">        content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">  BlogService.LoadPostContent( id );<br /></span><span style="COLOR: #008080"> 35</span><span style="COLOR: #000000">        <br /></span><span style="COLOR: #008080"> 36</span><span style="COLOR: #000000">        HttpContext.Current.Cache.Insert(key, content, </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">, DateTime.Now.AddMinutes(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">), TimeSpan.Zero);<br /></span><span style="COLOR: #008080"> 37</span><span style="COLOR: #000000">            <br /></span><span style="COLOR: #008080"> 38</span><span style="COLOR: #000000">        </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> if use xml store the data <br /></span><span style="COLOR: #008080"> 39</span><span style="COLOR: #008000">        </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> 更丑陋点的 new CacheDependency(_Folder + &#8221;posts&#92;&#8221; + id.ToString() + &#8221;.xml&#8221;) in the Cache.Insert Method </span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 40</span><span style="COLOR: #000000">    }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 41</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 42</span><span style="COLOR: #000000">}</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 43</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 44</span><span style="COLOR: #0000ff">private</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">static</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">object</span><span style="COLOR: #000000"> _SyncRoot </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">object</span><span style="COLOR: #000000">();<br /></span><span style="COLOR: #008080"> 45</span><span style="COLOR: #0000ff">private</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">static</span><span style="COLOR: #000000"> List</span><span style="COLOR: #000000">&lt;</span><span style="COLOR: #000000">Post</span><span style="COLOR: #000000">&gt;</span><span style="COLOR: #000000"> _Posts;<br /></span><span style="COLOR: #008080"> 46</span><span id="Codehighlighter1_998_1096_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff">/**/</span><span id="Codehighlighter1_998_1096_Open_Text"><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;summary&gt;</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 47</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> A sorted collection of all posts in the blog.<br /></span><span style="COLOR: #008080"> 48</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> Sorted by date.<br /></span><span style="COLOR: #008080"> 49</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;/summary&gt;</span></span><br /><span style="COLOR: #008080"> 50</span><span style="COLOR: #0000ff">public</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">static</span><span style="COLOR: #000000"> List</span><span style="COLOR: #000000">&lt;</span><span style="COLOR: #000000">Post</span><span style="COLOR: #000000">&gt;</span><span style="COLOR: #000000"> Posts<br /></span><span style="COLOR: #008080"> 51</span><span id="Codehighlighter1_1128_1351_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 52</span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">get</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 53</span><span style="COLOR: #000000">    </span><span id="Codehighlighter1_1136_1349_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 54</span><span style="COLOR: #000000">        </span><span style="COLOR: #0000ff">lock</span><span style="COLOR: #000000"> (_SyncRoot)<br /></span><span style="COLOR: #008080"> 55</span><span style="COLOR: #000000">        </span><span id="Codehighlighter1_1159_1346_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 56</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">          </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000"> (_Posts </span><span style="COLOR: #000000">==</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">)<br /></span><span style="COLOR: #008080"> 57</span><span style="COLOR: #000000"><img id="Codehighlighter1_1189_1323_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1189_1323_Open_Text.style.display='none'; Codehighlighter1_1189_1323_Closed_Image.style.display='inline'; Codehighlighter1_1189_1323_Closed_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif3" alt="" align="top">          </span><span id="Codehighlighter1_1189_1323_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 58</span><span style="COLOR: #000000">            </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">in provider the &#8217;FillPosts&#8217; method&#8217; dose not return the &#8217;real&#8217;  content&#8217; per post； </span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 59</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 60</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">            _Posts </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> BlogService.FillPosts( );<br /></span><span style="COLOR: #008080"> 61</span><span style="COLOR: #000000">          }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 62</span><span style="COLOR: #000000">          </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> _Posts;<br /></span><span style="COLOR: #008080"> 63</span><span style="COLOR: #000000">        }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 64</span><span style="COLOR: #000000">    }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 65</span><span style="COLOR: #000000">}</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 66</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 67</span><span style="COLOR: #0000ff">in</span><span style="COLOR: #000000"> XmlBlogProvider<br /></span><span style="COLOR: #008080"> 68</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 69</span><span id="Codehighlighter1_1374_1450_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff">/**/</span><span id="Codehighlighter1_1374_1450_Open_Text"><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;summary&gt;</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 70</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"></span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> Retrieves a post based on the specified Id.<br /></span><span style="COLOR: #008080"> 71</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif1" alt="" align="top"></span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;/summary&gt;</span></span><br /><span style="COLOR: #008080"> 72</span><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top"><span style="COLOR: #0000ff">public</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">override</span><span style="COLOR: #000000"> Post SelectPost(Guid id)<br /></span><span style="COLOR: #008080"> 73</span><span style="COLOR: #000000"><img id="Codehighlighter1_1492_2058_Open_Image" onclick="this.style.display='none'; Codehighlighter1_1492_2058_Open_Text.style.display='none'; Codehighlighter1_1492_2058_Closed_Image.style.display='inline'; Codehighlighter1_1492_2058_Closed_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif8" alt="" align="top"><img id="Codehighlighter1_1492_2058_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_1492_2058_Closed_Text.style.display='none'; Codehighlighter1_1492_2058_Open_Image.style.display='inline'; Codehighlighter1_1492_2058_Open_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif9" alt="" align="top"></span><span id="Codehighlighter1_1492_2058_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif2" alt=""></span><span id="Codehighlighter1_1492_2058_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 74</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> fileName </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> _Folder </span><span style="COLOR: #000000">+</span><span style="COLOR: #000000"> </span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">posts&#92;</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000"> </span><span style="COLOR: #000000">+</span><span style="COLOR: #000000"> id.ToString() </span><span style="COLOR: #000000">+</span><span style="COLOR: #000000"> </span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">.xml</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">;<br /></span><span style="COLOR: #008080"> 75</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    Post post </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000"> Post();<br /></span><span style="COLOR: #008080"> 76</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    XmlDocument doc </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000"> XmlDocument();<br /></span><span style="COLOR: #008080"> 77</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    doc.Load(fileName);<br /></span><span style="COLOR: #008080"> 78</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"><br /></span><span style="COLOR: #008080"> 79</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    post.Title </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> doc.SelectSingleNode(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">post/title</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">).InnerText;<br /></span><span style="COLOR: #008080"> 80</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    post.Description </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> doc.SelectSingleNode(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">post/description</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">).InnerText;<br /></span><span style="COLOR: #008080"> 81</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"><br /></span><span style="COLOR: #008080"> 82</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    post.Content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">;  </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> dose not return the &#8217;real&#8217;  content&#8217;</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 83</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 84</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    post.DateCreated </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> DateTime.Parse(doc.SelectSingleNode(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">post/pubDate</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">).InnerText);<br /></span><span style="COLOR: #008080"> 85</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    post.DateModified </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> DateTime.Parse(doc.SelectSingleNode(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">post/lastModified</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">).InnerText);<br /></span><span style="COLOR: #008080"> 86</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    <br /></span><span style="COLOR: #008080"> 87</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> setting other filed</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 88</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 89</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> post;<br /></span><span style="COLOR: #008080"> 90</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif1" alt="" align="top">}</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080"> 91</span><span style="COLOR: #000000"><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top">Post </span><span style="COLOR: #0000ff">class</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">in</span><span style="COLOR: #000000"> Business </span><span style="COLOR: #0000ff">object</span><span style="COLOR: #000000"> layer<br /></span><span style="COLOR: #008080"> 92</span><span style="COLOR: #000000"><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top"><br /></span><span style="COLOR: #008080"> 93</span><span style="COLOR: #000000"><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top"></span><span style="COLOR: #0000ff">private</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> _Content;<br /></span><span style="COLOR: #008080"> 94</span><span style="COLOR: #000000"><img id="Codehighlighter1_2122_2192_Open_Image" onclick="this.style.display='none'; Codehighlighter1_2122_2192_Open_Text.style.display='none'; Codehighlighter1_2122_2192_Closed_Image.style.display='inline'; Codehighlighter1_2122_2192_Closed_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif8" alt="" align="top"><img id="Codehighlighter1_2122_2192_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_2122_2192_Closed_Text.style.display='none'; Codehighlighter1_2122_2192_Open_Image.style.display='inline'; Codehighlighter1_2122_2192_Open_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif9" alt="" align="top"></span><span id="Codehighlighter1_2122_2192_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff">/**/</span><span id="Codehighlighter1_2122_2192_Open_Text"><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;summary&gt;</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080"> 95</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"></span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> Gets or sets the Content or the post.<br /></span><span style="COLOR: #008080"> 96</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif1" alt="" align="top"></span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;/summary&gt;</span></span><br /><span style="COLOR: #008080"> 97</span><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top"><span style="COLOR: #0000ff">public</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> Content<br /></span><span style="COLOR: #008080"> 98</span><span style="COLOR: #000000"><img id="Codehighlighter1_2215_2438_Open_Image" onclick="this.style.display='none'; Codehighlighter1_2215_2438_Open_Text.style.display='none'; Codehighlighter1_2215_2438_Closed_Image.style.display='inline'; Codehighlighter1_2215_2438_Closed_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif8" alt="" align="top"><img id="Codehighlighter1_2215_2438_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_2215_2438_Closed_Text.style.display='none'; Codehighlighter1_2215_2438_Open_Image.style.display='inline'; Codehighlighter1_2215_2438_Open_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif9" alt="" align="top"></span><span id="Codehighlighter1_2215_2438_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif2" alt=""></span><span id="Codehighlighter1_2215_2438_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080"> 99</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">  </span><span style="COLOR: #0000ff">get</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">100</span><span style="COLOR: #000000"><img id="Codehighlighter1_2225_2340_Open_Image" onclick="this.style.display='none'; Codehighlighter1_2225_2340_Open_Text.style.display='none'; Codehighlighter1_2225_2340_Closed_Image.style.display='inline'; Codehighlighter1_2225_2340_Closed_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif3" alt="" align="top"><img id="Codehighlighter1_2225_2340_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_2225_2340_Closed_Text.style.display='none'; Codehighlighter1_2225_2340_Open_Image.style.display='inline'; Codehighlighter1_2225_2340_Open_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif4" alt="" align="top">  </span><span id="Codehighlighter1_2225_2340_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif2" alt=""></span><span id="Codehighlighter1_2225_2340_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">101</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">      </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000"> ( _Content </span><span style="COLOR: #000000">==</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000"> )<br /></span><span style="COLOR: #008080">102</span><span style="COLOR: #000000"><img id="Codehighlighter1_2263_2313_Open_Image" onclick="this.style.display='none'; Codehighlighter1_2263_2313_Open_Text.style.display='none'; Codehighlighter1_2263_2313_Closed_Image.style.display='inline'; Codehighlighter1_2263_2313_Closed_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif3" alt="" align="top"><img id="Codehighlighter1_2263_2313_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_2263_2313_Closed_Text.style.display='none'; Codehighlighter1_2263_2313_Open_Image.style.display='inline'; Codehighlighter1_2263_2313_Open_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif4" alt="" align="top">      </span><span id="Codehighlighter1_2263_2313_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif2" alt=""></span><span id="Codehighlighter1_2263_2313_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">103</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">      _Content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> LoadPostContent( </span><span style="COLOR: #0000ff">this</span><span style="COLOR: #000000">.Id );<br /></span><span style="COLOR: #008080">104</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif5" alt="" align="top">      }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">105</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">      </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> _Content;<br /></span><span style="COLOR: #008080">106</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif5" alt="" align="top">  }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">107</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">  </span><span style="COLOR: #0000ff">set</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">108</span><span style="COLOR: #000000"><img id="Codehighlighter1_2350_2436_Open_Image" onclick="this.style.display='none'; Codehighlighter1_2350_2436_Open_Text.style.display='none'; Codehighlighter1_2350_2436_Closed_Image.style.display='inline'; Codehighlighter1_2350_2436_Closed_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif3" alt="" align="top"><img id="Codehighlighter1_2350_2436_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_2350_2436_Closed_Text.style.display='none'; Codehighlighter1_2350_2436_Open_Image.style.display='inline'; Codehighlighter1_2350_2436_Open_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif4" alt="" align="top">  </span><span id="Codehighlighter1_2350_2436_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif2" alt=""></span><span id="Codehighlighter1_2350_2436_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">109</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">      </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000"> ( _Content </span><span style="COLOR: #000000">!=</span><span style="COLOR: #000000"> value )<br /></span><span style="COLOR: #008080">110</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">      MarkDirty( </span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">Content</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000"> );<br /></span><span style="COLOR: #008080">111</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">      _Content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> value;<br /></span><span style="COLOR: #008080">112</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif5" alt="" align="top">  }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">113</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif1" alt="" align="top">}</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">114</span><span style="COLOR: #000000"><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top"></span><span style="COLOR: #0000ff">private</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> LoadPostContent(Guid id)<br /></span><span style="COLOR: #008080">115</span><span style="COLOR: #000000"><img id="Codehighlighter1_2480_3081_Open_Image" onclick="this.style.display='none'; Codehighlighter1_2480_3081_Open_Text.style.display='none'; Codehighlighter1_2480_3081_Closed_Image.style.display='inline'; Codehighlighter1_2480_3081_Closed_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif8" alt="" align="top"><img id="Codehighlighter1_2480_3081_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_2480_3081_Closed_Text.style.display='none'; Codehighlighter1_2480_3081_Open_Image.style.display='inline'; Codehighlighter1_2480_3081_Open_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif9" alt="" align="top"></span><span id="Codehighlighter1_2480_3081_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif2" alt=""></span><span id="Codehighlighter1_2480_3081_Open_Text"><span style="COLOR: #000000">{    <br /></span><span style="COLOR: #008080">116</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> key </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000">.Format(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">Be:Content:{0}</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">,id);<br /></span><span style="COLOR: #008080">117</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">;<br /></span><span style="COLOR: #008080">118</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> if there is no content cached by id</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">119</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"></span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">object</span><span style="COLOR: #000000"> obj </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> HttpContext.Current.Cache.Get(key);<br /></span><span style="COLOR: #008080">120</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000">(obj </span><span style="COLOR: #000000">==</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">)<br /></span><span style="COLOR: #008080">121</span><span style="COLOR: #000000"><img id="Codehighlighter1_2665_3057_Open_Image" onclick="this.style.display='none'; Codehighlighter1_2665_3057_Open_Text.style.display='none'; Codehighlighter1_2665_3057_Closed_Image.style.display='inline'; Codehighlighter1_2665_3057_Closed_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif3" alt="" align="top"><img id="Codehighlighter1_2665_3057_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_2665_3057_Closed_Text.style.display='none'; Codehighlighter1_2665_3057_Open_Image.style.display='inline'; Codehighlighter1_2665_3057_Open_Text.style.display='inline';" src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif4" alt="" align="top">    </span><span id="Codehighlighter1_2665_3057_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif2" alt=""></span><span id="Codehighlighter1_2665_3057_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">122</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">        </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> load the post&#8217;s content from provider here</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">123</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"></span><span style="COLOR: #000000">        content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000">  BlogService.LoadPostContent( id );<br /></span><span style="COLOR: #008080">124</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">        <br /></span><span style="COLOR: #008080">125</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">        HttpContext.Current.Cache.Insert(key, content, </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">, DateTime.Now.AddMinutes(</span><span style="COLOR: #000000">2</span><span style="COLOR: #000000">), TimeSpan.Zero);<br /></span><span style="COLOR: #008080">126</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">            <br /></span><span style="COLOR: #008080">127</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">        </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> if use xml store the data <br /></span><span style="COLOR: #008080">128</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">        </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> we can use a  CacheDependency like new CacheDependency(_Folder + &#8221;posts&#92;&#8221; + id.ToString() + &#8221;.xml&#8221;) in the Cache.Insert Method </span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">129</span><span style="COLOR: #008000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"></span><span style="COLOR: #000000">    <br /></span><span style="COLOR: #008080">130</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> content;<br /></span><span style="COLOR: #008080">131</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif5" alt="" align="top">    }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">132</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top">    </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> (strong)obj;<br /></span><span style="COLOR: #008080">133</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif0" alt="" align="top"><br /></span><span style="COLOR: #008080">134</span><span style="COLOR: #000000"><img src="/images/hbz_images/9432c27b-2893-4018-946c-4bf16f270ce1.gif1" alt="" align="top">}</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">135</span><span style="COLOR: #000000"><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top"><br /></span><span style="COLOR: #008080">136</span><span style="COLOR: #000000"><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top"></span><span style="COLOR: #0000ff">private</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">static</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">object</span><span style="COLOR: #000000"> _SyncRoot </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">object</span><span style="COLOR: #000000">();<br /></span><span style="COLOR: #008080">137</span><span style="COLOR: #000000"><img src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif7" alt="" align="top"></span><span style="COLOR: #0000ff">private</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">static</span><span style="COLOR: #000000"> List</span><span style="COLOR: #000000">&lt;</span><span style="COLOR: #000000">Post</span><span style="COLOR: #000000">&gt;</span><span style="COLOR: #000000"> _Posts;<br /></span><span style="COLOR: #008080">138</span><span style="COLOR: #000000"><img id="Codehighlighter1_3166_3264_Closed_Image" style="DISPLAY: none" onclick="this.style.display='none'; Codehighlighter1_3166_3264_Closed_Text.style.display='none'; Codehighlighter1_3166_3264_Open_Image.style.display='inline'; Codehighlighter1_3166_3264_Open_Text.style.display='inline';" src="/images/hbz_images/c235e789-7a8e-44fc-aa05-76f3ffaeceec.gif9" alt="" align="top"></span><span id="Codehighlighter1_3166_3264_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff">/**/</span><span id="Codehighlighter1_3166_3264_Open_Text"><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;summary&gt;</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">139</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> A sorted collection of all posts in the blog.<br /></span><span style="COLOR: #008080">140</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> Sorted by date.<br /></span><span style="COLOR: #008080">141</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;/summary&gt;</span></span><br /><span style="COLOR: #008080">142</span><span style="COLOR: #0000ff">public</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">static</span><span style="COLOR: #000000"> List</span><span style="COLOR: #000000">&lt;</span><span style="COLOR: #000000">Post</span><span style="COLOR: #000000">&gt;</span><span style="COLOR: #000000"> Posts<br /></span><span style="COLOR: #008080">143</span><span id="Codehighlighter1_3296_3519_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">144</span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">get</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">145</span><span style="COLOR: #000000">    </span><span id="Codehighlighter1_3304_3517_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">146</span><span style="COLOR: #000000">        </span><span style="COLOR: #0000ff">lock</span><span style="COLOR: #000000"> (_SyncRoot)<br /></span><span style="COLOR: #008080">147</span><span style="COLOR: #000000">        </span><span id="Codehighlighter1_3327_3514_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">148</span><span style="COLOR: #000000">          </span><span style="COLOR: #0000ff">if</span><span style="COLOR: #000000"> (_Posts </span><span style="COLOR: #000000">==</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">)<br /></span><span style="COLOR: #008080">149</span><span style="COLOR: #000000">          </span><span id="Codehighlighter1_3357_3491_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">150</span><span style="COLOR: #000000">            </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000">in provider the &#8217;FillPosts&#8217; method&#8217; dose not return the &#8217;real&#8217;  content&#8217; per post； </span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">151</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">152</span><span style="COLOR: #000000">            _Posts </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> BlogService.FillPosts( );<br /></span><span style="COLOR: #008080">153</span><span style="COLOR: #000000">          }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">154</span><span style="COLOR: #000000">          </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> _Posts;<br /></span><span style="COLOR: #008080">155</span><span style="COLOR: #000000">        }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">156</span><span style="COLOR: #000000">    }</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">157</span><span style="COLOR: #000000">}</span></span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">158</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">159</span><span style="COLOR: #0000ff">in</span><span style="COLOR: #000000"> XmlBlogProvider<br /></span><span style="COLOR: #008080">160</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">161</span><span id="Codehighlighter1_3542_3618_Closed_Text" style="BORDER-RIGHT: #808080 1px solid; BORDER-TOP: #808080 1px solid; DISPLAY: none; BORDER-LEFT: #808080 1px solid; BORDER-BOTTOM: #808080 1px solid; BACKGROUND-COLOR: #ffffff">/**/</span><span id="Codehighlighter1_3542_3618_Open_Text"><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;summary&gt;</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">162</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> Retrieves a post based on the specified Id.<br /></span><span style="COLOR: #008080">163</span><span style="COLOR: #808080">///</span><span style="COLOR: #008000"> </span><span style="COLOR: #808080">&lt;/summary&gt;</span></span><br /><span style="COLOR: #008080">164</span><span style="COLOR: #0000ff">public</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">override</span><span style="COLOR: #000000"> Post SelectPost(Guid id)<br /></span><span style="COLOR: #008080">165</span><span id="Codehighlighter1_3660_4226_Open_Text"><span style="COLOR: #000000">{<br /></span><span style="COLOR: #008080">166</span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">string</span><span style="COLOR: #000000"> fileName </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> _Folder </span><span style="COLOR: #000000">+</span><span style="COLOR: #000000"> </span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">posts&#92;</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000"> </span><span style="COLOR: #000000">+</span><span style="COLOR: #000000"> id.ToString() </span><span style="COLOR: #000000">+</span><span style="COLOR: #000000"> </span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">.xml</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">;<br /></span><span style="COLOR: #008080">167</span><span style="COLOR: #000000">    Post post </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000"> Post();<br /></span><span style="COLOR: #008080">168</span><span style="COLOR: #000000">    XmlDocument doc </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">new</span><span style="COLOR: #000000"> XmlDocument();<br /></span><span style="COLOR: #008080">169</span><span style="COLOR: #000000">    doc.Load(fileName);<br /></span><span style="COLOR: #008080">170</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">171</span><span style="COLOR: #000000">    post.Title </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> doc.SelectSingleNode(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">post/title</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">).InnerText;<br /></span><span style="COLOR: #008080">172</span><span style="COLOR: #000000">    post.Description </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> doc.SelectSingleNode(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">post/description</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">).InnerText;<br /></span><span style="COLOR: #008080">173</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">174</span><span style="COLOR: #000000">    post.Content </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> </span><span style="COLOR: #0000ff">null</span><span style="COLOR: #000000">; </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> dose not return the &#8217;real&#8217;  content&#8217;</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">175</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">176</span><span style="COLOR: #000000">    post.DateCreated </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> DateTime.Parse(doc.SelectSingleNode(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">post/pubDate</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">).InnerText);<br /></span><span style="COLOR: #008080">177</span><span style="COLOR: #000000">    post.DateModified </span><span style="COLOR: #000000">=</span><span style="COLOR: #000000"> DateTime.Parse(doc.SelectSingleNode(</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">post/lastModified</span><span style="COLOR: #000000">&#8221;</span><span style="COLOR: #000000">).InnerText);<br /></span><span style="COLOR: #008080">178</span><span style="COLOR: #000000">    <br /></span><span style="COLOR: #008080">179</span><span style="COLOR: #000000">    </span><span style="COLOR: #008000">//</span><span style="COLOR: #008000"> setting other fileds</span><span style="COLOR: #008000"><br /></span><span style="COLOR: #008080">180</span><span style="COLOR: #000000"><br /></span><span style="COLOR: #008080">181</span><span style="COLOR: #000000">    </span><span style="COLOR: #0000ff">return</span><span style="COLOR: #000000"> post;<br /></span><span style="COLOR: #008080">182</span><span style="COLOR: #000000">}</span></span>
</div>


<p>个人觉得 是否应该对于Content、Comment这种占用大量内存的字段是否该采用类似Lazy Initialization 的方式<br />说明：第一次加载所有post时候 post list内的item不带真实的comtent和comment等<br />然后在用到的时候再从数据库读取，然后放入缓存，下次备用<br />这样Posts内的item都变的瘦多了，类似于延迟初始化（Lazy Initialization ）<br />请大家讨论讨论，谢谢！</p>


<p></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Marble Wu</span></span>

      








  


<time datetime="2007-07-04T13:13:00+08:00" pubdate data-updated="true">Jul 4<span>th</span>, 2007</time>
      

<span class="categories">
  
    <a class='category' href='/blog/tag/-net其他/'>.Net其他</a>, <a class='category' href='/blog/tag/asp-net/'>ASP.NET</a>, <a class='category' href='/blog/tag/asp-net/'>Asp.net</a>, <a class='category' href='/blog/tag/blogengine-net/'>BlogEngine.NET</a>, <a class='category' href='/blog/tag/lazyload/'>LazyLoad</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://huobazi.github.com/blog/2007/07/04/lazyinitializationorearlyinitializationinblogengine/" data-via="huobazi" data-counturl="http://huobazi.github.com/blog/2007/07/04/lazyinitializationorearlyinitializationinblogengine/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2007/06/21/gotdotnetwillberetired/" title="Previous Post: GotDotNet.Com要退休了">&laquo; GotDotNet.Com要退休了</a>
      
      
        <a class="basic-alignment right" href="/blog/2007/07/07/dotnetjobscn/" title="Next Post: .Net专业人力资源网上线试运行.">.Net专业人力资源网上线试运行. &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("huobazi", 10, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/huobazi" class="twitter-follow-button" data-show-count="false">Follow @huobazi</a>
  
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/11/26/osx-shang-mo-ren-vim-bu-zhi-chi-plus-ji-cun-qi/">OSX 上默认 VIM 不支持 + 寄存器</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/11/02/tmux-diu-shi-huo-xian-shi-vimde-pei-se/">tmux丢失或显示vim的配色</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/12/import-data-from-mysql-to-postgresql/">将 MySQL 的数据导入 PostgreSQL</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/15/ajaxupload-with-rail-carrierwave-on-mongodb/">使用AjaxUpload和Carrierwave在Rails && Mongoid中批量上传图片'</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/06/convert-typecho-to-octopress/">从typecho转换到Octopress了</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/25/hg232/">HG232破解一例</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/13/ios-uiactionsheetdelegate/">iOS通过UIActionSheetDelegate来实现警告的方法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/02/04/ubuntu-sublime-text-chinese/">Ubuntu下设置 Sublime Text 2 显示中文 && 输入中文</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/09/ios-hide-keyboard-when-touch/">[How to]在iOS中点击文本框以外区域，隐藏键盘</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/28/how-to-uninstall-xcode/"> [How to] 如何卸载Xcode</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/huobazi">@huobazi</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'huobazi',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Marble Wu -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'huobaziblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://huobazi.github.com/blog/2007/07/04/lazyinitializationorearlyinitializationinblogengine/';
        var disqus_url = 'http://huobazi.github.com/blog/2007/07/04/lazyinitializationorearlyinitializationinblogengine/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
