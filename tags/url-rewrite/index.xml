<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Url Rewrite on 武眉博</title>
    <link>http://huobazi.aspxboy.com/tags/url-rewrite/</link>
    <description>Recent content in Url Rewrite on 武眉博</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Mon, 21 Nov 2005 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://huobazi.aspxboy.com/tags/url-rewrite/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>关于请求的目录不存在而需要url重写</title>
      <link>http://huobazi.aspxboy.com/blog/2005/11/21/nodirurlrewrite/</link>
      <pubDate>Mon, 21 Nov 2005 00:00:00 +0000</pubDate>
      
      <guid>http://huobazi.aspxboy.com/blog/2005/11/21/nodirurlrewrite/</guid>
      <description>&lt;p&gt;在&lt;a href=&#34;http://pwqzc.cnblogs.com/archive/2005/11/21/281331.html&#34; target=&#34;_blank&#34;&gt;http://pwqzc.cnblogs.com/archive/2005/11/21/281331.html&lt;/a&gt;看到的讨论&lt;br /&gt;其实csdn的那两个帖子&lt;br /&gt;&lt;a href=&#34;http://community.csdn.net/Expert/topic/4401/4401936.xml?temp=.317898&#34; target=&#34;_blank&#34;&gt;http://community.csdn.net/Expert/topic/4401/4401936.xml?temp=.317898&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://community.csdn.net/Expert/topic/4406/4406615.xml?temp=.513714&#34; target=&#34;_blank&#34;&gt;http://community.csdn.net/Expert/topic/4406/4406615.xml?temp=.513714&lt;/a&gt;&lt;br /&gt;中已经有网友们说到方法了，hander module 都可以做&lt;br /&gt;在iis中设置*.*映射到 aspnet_isapi.dll ISAPI 扩展，我测试后没有发现什么访问被拒绝访问的401.3错误,&lt;br /&gt;需要输入用户名的问题。&lt;br /&gt;&lt;img style=&#34;width: 627px; height: 396px; border: 0px;&#34; src=&#34;http://huobazi.aspxboy.com/images/hbz_images/5c851a33-204d-4d19-a338-3220cd1979ae.gif&#34; border=&#34;0&#34; alt=&#34;&#34;&gt;&lt;br /&gt;  &lt;/p&gt;
&lt;p&gt;以下在代码xpsp2 .net1.1 sp1 下测试通过&lt;/p&gt;
&lt;div style=&#34;cursor: hand; color: blue; text-align: left; text-decoration: underline;&#34; title=&#34;&amp;gt;-点此复制到剪贴板-&amp;lt;&#34; onclick=&#39;function anonymous() { var obj = document.getElementById(&#34;code_huobazi_code&#34;);    if( obj != null )   {       var rng = document.body.createTextRange();      rng.moveToElementText(obj);         rng.scrollIntoView();       rng.select();       rng.execCommand(&#34;Copy&#34;);        rng.collapse(false);    } }&#39;&gt;[Copy to clipboard]&lt;/div&gt;
&lt;p&gt;&lt;textarea id=&#34;code_huobazi_code&#34; style=&#34;width: 632px; height: 298px; background-color: #ffcc00;&#34; cols=&#34;84&#34; rows=&#34;4&#34;&gt;using System;&amp;lt;br /&amp;gt; using System.Web;&amp;lt;br /&amp;gt; using System.Web.UI;&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;namespace AspxBoy.VisualUrl&amp;lt;br /&amp;gt; {&amp;lt;br /&amp;gt;   /// &amp;lt;summary&amp;gt;&amp;lt;br /&amp;gt;     /// VisualUrlHttpHander 的摘要说明。&amp;lt;br /&amp;gt;  /// &amp;lt;/summary&amp;gt;&amp;lt;br /&amp;gt;    public class VisualUrlHttpHander : IHttpHandlerFactory&amp;lt;br /&amp;gt;  {&amp;lt;br /&amp;gt;       #region IHttpHandlerFactory 成员&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;     public void ReleaseHandler(IHttpHandler handler)&amp;lt;br /&amp;gt;        {&amp;lt;br /&amp;gt;           // TODO:  添加 VisualUrlHttpHander.ReleaseHandler 实现&amp;lt;br /&amp;gt;      }&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;      public IHttpHandler GetHandler(HttpContext context, string requestType, string url, string pathTranslated)&amp;lt;br /&amp;gt;      {&amp;lt;br /&amp;gt;           // TODO:  添加 VisualUrlHttpHander.GetHandler 实现&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;         string rawUrl = context.Request.RawUrl.Trim();&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;         ///&amp;lt;br /&amp;gt;             ///这里只示范地址是http://domainname/xxx&amp;lt;br /&amp;gt;            ///和http://domainname/xxx/这样的地址&amp;lt;br /&amp;gt;             ///&amp;lt;br /&amp;gt;             string userName = rawUrl.TrimStart(&#39;/&#39;).TrimEnd(&#39;/&#39;);&amp;lt;br /&amp;gt;           string sendToUrl = url;&amp;lt;br /&amp;gt;             string filePath = pathTranslated;&amp;lt;br /&amp;gt;           string sendToUrlLessQString;&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;           sendToUrl = Globals.AppPath + &#34;/get.aspx?username=&#34; + userName;&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;            Globals.RewriteUrl(context, sendToUrl, out sendToUrlLessQString, out filePath);&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;            return PageParser.GetCompiledPageInstance(sendToUrlLessQString, filePath, context);&amp;lt;br /&amp;gt;         }&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;      #endregion&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt; }&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;  public class Globals&amp;lt;br /&amp;gt;    {&amp;lt;br /&amp;gt;       /// &amp;lt;summary&amp;gt;&amp;lt;br /&amp;gt;         /// 应用程序路径&amp;lt;br /&amp;gt;      /// &amp;lt;/summary&amp;gt;&amp;lt;br /&amp;gt;        public static string AppPath&amp;lt;br /&amp;gt;        {&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;          get&amp;lt;br /&amp;gt;             {&amp;lt;br /&amp;gt;               string applicationPath = &#34;/&#34;;&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;              if(HttpContext.Current != null)&amp;lt;br /&amp;gt;                 {&amp;lt;br /&amp;gt; applicationPath = HttpContext.Current.Request.ApplicationPath;&amp;lt;br /&amp;gt;                }&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;              if (applicationPath == &#34;/&#34;)&amp;lt;br /&amp;gt;                 {&amp;lt;br /&amp;gt; return string.Empty;&amp;lt;br /&amp;gt;              }&amp;lt;br /&amp;gt;               else&amp;lt;br /&amp;gt;                {&amp;lt;br /&amp;gt; if (applicationPath.EndsWith(&#34;/&#34;))&amp;lt;br /&amp;gt; {&amp;lt;br /&amp;gt;  return applicationPath;&amp;lt;br /&amp;gt; }&amp;lt;br /&amp;gt; else&amp;lt;br /&amp;gt; {&amp;lt;br /&amp;gt;    return applicationPath + &#34;/&#34;;&amp;lt;br /&amp;gt; }&amp;lt;br /&amp;gt;                 }&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;          }&amp;lt;br /&amp;gt;       }&amp;lt;br /&amp;gt;       /// &amp;lt;summary&amp;gt;&amp;lt;br /&amp;gt;         /// 在ASP.NET中执行URL重写&amp;lt;br /&amp;gt;        /// see http://www.aspxboy.com/484/archive.aspx&amp;lt;br /&amp;gt;         /// &amp;lt;/summary&amp;gt;&amp;lt;br /&amp;gt;        /// &amp;lt;param name=&#34;context&#34;&amp;gt;&amp;lt;/param&amp;gt;&amp;lt;br /&amp;gt;      /// &amp;lt;param name=&#34;sendToUrl&#34;&amp;gt;&amp;lt;/param&amp;gt;&amp;lt;br /&amp;gt;        /// &amp;lt;param name=&#34;sendToUrlLessQString&#34;&amp;gt;&amp;lt;/param&amp;gt;&amp;lt;br /&amp;gt;         /// &amp;lt;param name=&#34;filePath&#34;&amp;gt;&amp;lt;/param&amp;gt;&amp;lt;br /&amp;gt;         public static  void RewriteUrl(HttpContext context, string sendToUrl, out string sendToUrlLessQString, out string filePath)&amp;lt;br /&amp;gt;         {&amp;lt;br /&amp;gt;           if (context.Request.QueryString.Count &amp;gt; 0)&amp;lt;br /&amp;gt;           {&amp;lt;br /&amp;gt;               if (sendToUrl.IndexOf(&#39;?&#39;) != -1)&amp;lt;br /&amp;gt;               {&amp;lt;br /&amp;gt; sendToUrl += &#34;&amp;amp;&#34; + context.Request.QueryString.ToString();&amp;lt;br /&amp;gt;                }&amp;lt;br /&amp;gt;               else&amp;lt;br /&amp;gt;                {&amp;lt;br /&amp;gt; sendToUrl += &#34;?&#34; + context.Request.QueryString.ToString();&amp;lt;br /&amp;gt;                }&amp;lt;br /&amp;gt;           }&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;          string queryString = String.Empty;&amp;lt;br /&amp;gt;          sendToUrlLessQString = sendToUrl;&amp;lt;br /&amp;gt;           if (sendToUrl.IndexOf(&#39;?&#39;) &amp;gt; 0)&amp;lt;br /&amp;gt;          {&amp;lt;br /&amp;gt;               sendToUrlLessQString = sendToUrl.Substring(0, sendToUrl.IndexOf(&#39;?&#39;));&amp;lt;br /&amp;gt;              queryString = sendToUrl.Substring(sendToUrl.IndexOf(&#39;?&#39;) + 1);&amp;lt;br /&amp;gt;          }&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;          filePath = string.Empty;&amp;lt;br /&amp;gt;            filePath = context.Server.MapPath(sendToUrlLessQString);&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;           context.RewritePath(sendToUrlLessQString, String.Empty, queryString);&amp;lt;br /&amp;gt;       }&amp;lt;br /&amp;gt;   }&amp;lt;br /&amp;gt; }&amp;lt;/div&amp;gt; &amp;lt;div  mce_tmp=&#34;1&#34;&amp;gt;&lt;/textarea&gt;&lt;/p&gt;
&lt;p&gt;下载&lt;br /&gt;&lt;a href=&#34;http://www.cnblogs.com/Files/huobazi/VisualUrl.rar&#34;&gt;http://www.cnblogs.com/Files/huobazi/VisualUrl.rar&lt;/a&gt;&lt;/p&gt;              
</description>
    </item>
    
  </channel>
</rss>