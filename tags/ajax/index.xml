<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Ajax on 武眉博</title>
    <link>http://huobazi.aspxboy.com/tags/ajax/</link>
    <description>Recent content in Ajax on 武眉博</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Wed, 15 Aug 2012 00:00:00 +0000</lastBuildDate>
    <atom:link href="http://huobazi.aspxboy.com/tags/ajax/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>使用AjaxUpload和Carrierwave在Rails Mongoid中批量上传图片</title>
      <link>http://huobazi.aspxboy.com/blog/2012/08/15/ajaxupload-with-rail-carrierwave-on-mongodb/</link>
      <pubDate>Wed, 15 Aug 2012 00:00:00 +0000</pubDate>
      
      <guid>http://huobazi.aspxboy.com/blog/2012/08/15/ajaxupload-with-rail-carrierwave-on-mongodb/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;https://github.com/valums/file-uploader&#34;&gt;file-uploader&lt;/a&gt;是一个用 Javascrit 编写的文件上传 Libary,在这里我使用&lt;a href=&#34;https://github.com/jnicklas/carrierwave&#34;&gt;CarrierWave&lt;/a&gt;和 &lt;a href=&#34;https://github.com/mongoid/mongoid&#34;&gt;Mongoid&lt;/a&gt; 来完成多文件的无刷新上传功能&lt;/p&gt;

&lt;h2 id=&#34;rubygems:7371c11e255b336e41edb223ab46297b&#34;&gt;RubyGems&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;gem &#39;mongoid&#39;, &#39;3.0.4&#39;
gem &#39;carrierwave&#39;, &#39;0.6.2&#39;
gem &#39;carrierwave-mongoid&#39;, :github =&amp;gt; &#39;jnicklas/carrierwave-mongoid&#39;, :branch =&amp;gt; &#39;mongoid-3.0&#39; 
gem &#39;mini_magick&#39;, &#39;3.4&#39;
gem &#39;rack-raw-upload&#39;, &#39;1.1.0&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;model:7371c11e255b336e41edb223ab46297b&#34;&gt;Model&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;class Screenshot
  include Mongoid::Document
  include Mongoid::Timestamps::Created
  include Rails.application.routes.url_helpers

  attr_accessible :image 
  field :image 

  mount_uploader :image, ScreenshotUploader 

end
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;controller:7371c11e255b336e41edb223ab46297b&#34;&gt;Controller&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;class ScreenshotsController &amp;lt; ApplicationController

  def index
    @screenshots = Screenshot.all.desc(:created_at)

    respond_to do |format|
      format.html # index.html.erb    
      format.js{ render :layout =&amp;gt; false}
    end
  end

  def create
    file = params[:qqfile].is_a?(ActionDispatch::Http::UploadedFile) ? params[:qqfile] : params[:file]
    @screenshot = Screenshot.new
    @screenshot.image = file
    if @screenshot.save
      render json: { success: true, src: @screenshot.to_json }
    else
      render json: @screenshot.errors.to_json
    end
  end

  def destroy
    @screenshot = Screenshot.find(params[:id])
    @screenshot.destroy

    respond_to do |format|
      format.html { redirect_to screenshots_path }
      format.js{ 
        @screenshots = Screenshot.all.desc(:created_at)
        render :layout =&amp;gt; false
      }
    end

  end

end
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;uploader:7371c11e255b336e41edb223ab46297b&#34;&gt;Uploader&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;# encoding: utf-8
require &amp;quot;digest/md5&amp;quot;
require &#39;carrierwave/processing/mini_magick&#39;

class ScreenshotUploader &amp;lt; CarrierWave::Uploader::Base
  include CarrierWave::MiniMagick

  storage :file

  # Override the directory where uploaded files will be stored.
  def store_dir
    &amp;quot;uploads/#{model.class.to_s.underscore}/#{mounted_as}/#{model.id}&amp;quot;
  end


  process :convert =&amp;gt; &#39;png&#39;

  # Create different versions of your uploaded files:
  version :thumb do
    process :resize_to_fill =&amp;gt; [120, 120]
  end

  # Add a white list of extensions which are allowed to be uploaded.
  def extension_white_list
    %w(jpg jpeg gif png)
  end

  # Override the filename of the uploaded files:
  # see http://huacnlee.com/blog/carrierwave-upload-store-file-name-config/
  def filename
    if super.present?
      # current_path 是 Carrierwave 上传过程临时创建的一个文件，有时间标记，所以它将是唯一的
      @name ||= Digest::MD5.hexdigest(File.dirname(current_path))
      &amp;quot;#{@name}.#{file.extension.downcase}&amp;quot;
    end
  end
end
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;javascript:7371c11e255b336e41edb223ab46297b&#34;&gt;Javascript&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-javascript&#34;&gt;  $(document).ready(function(){

    var uploader = new qq.FileUploader({
      debug: true,
      allowedExtensions: [&#39;jpg&#39;, &#39;jpeg&#39;, &#39;png&#39;, &#39;gif&#39;],
      sizeLimit: 1048576, // max size: 1MB
      minSizeLimit: 0, // min size
      multiple: true,
      element: document.getElementById(&#39;file-uploader&#39;),
      action: &#39;&amp;lt;%= screenshots_path %&amp;gt;&#39;,
      onComplete: function(id, fileName, responseJSON){
        $.getScript(&amp;quot;&amp;lt;%= screenshots_path %&amp;gt;&amp;quot;);
      },
      onSubmit: function(id, fileName) {
        uploader.setParams({
          xx: &amp;quot;xx&amp;quot;,
          yy: &#39;yy&#39;,
          zz: &#39;zz&#39;,       
          authenticity_token: &amp;quot;&amp;lt;%= form_authenticity_token.to_s %&amp;gt;&amp;quot;
        });
      }
    });

});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;你可以在 &lt;a href=&#34;https://github.com/huobazi/ajax-upload-with-carrierwave-mongoid&#34;&gt;https://github.com/huobazi/ajax-upload-with-carrierwave-mongoid&lt;/a&gt;下载完整的示例代码&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MS Ajax 客户端生命周期</title>
      <link>http://huobazi.aspxboy.com/blog/2008/04/03/microsoftajaxclientlifecycle/</link>
      <pubDate>Thu, 03 Apr 2008 00:00:00 +0000</pubDate>
      
      <guid>http://huobazi.aspxboy.com/blog/2008/04/03/microsoftajaxclientlifecycle/</guid>
      <description>&lt;p&gt;The flowing reference  is an excellent post ！！！&lt;br /&gt;&lt;br /&gt;&lt;a target=&#34;_blank&#34; href=&#34;http://aspnetresources.com/downloads/MS%20Ajax%20Client%20Life-Cycle%20Events.pdf&#34;&gt;http://aspnetresources.com/downloads/MS%20Ajax%20Client%20Life-Cycle%20Events.pdf&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;               
</description>
    </item>
    
    <item>
      <title>FckEditor,远程图片下载,插件</title>
      <link>http://huobazi.aspxboy.com/blog/2007/11/02/fckeditorremoteimagerubber/</link>
      <pubDate>Fri, 02 Nov 2007 00:00:00 +0000</pubDate>
      
      <guid>http://huobazi.aspxboy.com/blog/2007/11/02/fckeditorremoteimagerubber/</guid>
      <description>&lt;div&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;有时候我们从其他网页上拷贝来的内容中含有图片，当原始地址失效后就会影响读者阅读。&lt;br /&gt;所以我制作了这样一个插件，可以将远程图片保存到本地服务器。&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;strong&gt;声明：&lt;span style=&#34;font-family: Courier New;&#34;&gt;下面的文字是本文不可缺少的部分，转载请保留，谢谢！&lt;/span&gt;&lt;/strong&gt;&lt;br /&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;////////////////////////////////////////////////////&lt;/span&gt;&lt;br /&gt;作者：武眉博&amp;lt;活靶子.NET&amp;gt;&lt;br /&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;同时首发于：&lt;br /&gt;    &lt;a href=&#34;http://www.im286.com&#34; target=&#34;_blank&#34;&gt;落伍者&lt;/a&gt;   &amp;amp;&amp;amp; &lt;a href=&#34;http://www.cnblogs.com&#34; target=&#34;_blank&#34;&gt;博客园&lt;/a&gt;  &lt;br /&gt;    &lt;a href=&#34;http://www.devedu.com&#34; target=&#34;_blank&#34;&gt;开发者学院&lt;/a&gt;   &amp;amp;&amp;amp; &lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;a href=&#34;http://www.aspxboy.com&#34; target=&#34;_blank&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;.Net男孩社区&lt;/span&gt;&lt;/a&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;////////////////////////////////////////////////////&lt;/span&gt;&lt;br /&gt;&lt;/span&gt;今天转载了&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;a&gt;xiaozhuang&lt;/a&gt;&lt;/span&gt;朋友的文章同时从博客园服务器上下载了图片&lt;br /&gt;演示见：&lt;a href=&#34;http://www.devedu.com/Doc/DotNet/AspNet/AspNet-AjaxWCF-ServiceADONET-Entity-FrameworkShiXianShuJuLieBiaoShuJuShaiXuanFenYePaiXuShanChu.aspx&#34;&gt;http://www.devedu.com/Doc/DotNet/AspNet/AspNet-AjaxWCF-ServiceADONET-Entity-FrameworkShiXianShuJuLieBiaoShuJuShaiXuanFenYePaiXuShanChu.aspx&lt;/a&gt;&lt;/span&gt;&lt;br /&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;img style=&#34;border: 0px;&#34; src=&#34;http://huobazi.aspxboy.com/images/hbz_images/90c5f692-c4e2-4a9f-ac83-cfb8d3400f70.JPG&#34; border=&#34;0&#34; alt=&#34;&#34;&gt;&lt;br /&gt;原理如下：&lt;br /&gt;    1.实现ICallbackEventHandler接口以用启用客户端回调。&lt;br /&gt;    2.从当前FckEdiotr内容分析出所有&amp;lt;img标签，取得src的地址。&lt;br /&gt;    3.回调下载到服务器。&lt;br /&gt;    4.返回下载后位于本服务器上的路径。&lt;br /&gt;    5.替换当前FckEdiotr内容内对应的&amp;lt;img标签的src属性。&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt; &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt; &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;br /&gt;&lt;p&gt; &lt;br /&gt;&lt;/p&gt;&lt;/span&gt;&lt;/span&gt;&lt;br /&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;其他废话不多说了，代码中都有注释。&lt;/span&gt;&lt;br /&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;如果您熟悉Fckeditor的插件工作流程，请继续向下阅读，另请不要留言要我直接提供下载，下面的代码已经可以完整调试了。&lt;br /&gt;E:\IISROOT\FckTest\FckTest\fckeditor\editor\plugins\remoteimagerubber\&lt;span style=&#34;font-family: Courier New;&#34;&gt;remoteimagerubber.aspx&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt; &lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;p&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;span style=&#34;font-family: Courier New;&#34;&gt;&lt;br /&gt; &lt;br /&gt;&lt;/span&gt;&lt;/span&gt;&lt;br /&gt; &lt;br /&gt;&lt;/p&gt;
&lt;br /&gt; &lt;p&gt;&lt;/p&gt;
&lt;div style=&#34;padding-right: 5px; padding-left: 4px; font-size: 13px; padding-bottom: 4px; width: 98%; word-break: break-all; padding-top: 4px; background-color: #eeeeee; border: #cccccc 1px solid;&#34;&gt;
&lt;span style=&#34;color: #008080&#34;&gt;  1&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;&amp;lt;%&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;--&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;  2&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;使用单页模型(非代码后置)，是为了便于此插件部署，&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;  3&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;不需编译成dll，只需拷贝remoteimagerubber.aspx 和 fckplugin.js 到plugn目录，&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;  4&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;并配置一下fckconfig.js及相应的语言包，就可以使用了。&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;  5&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;--&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;%&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;  6&lt;/span&gt; &lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;  7&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;&amp;lt;%&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;@ Page Language&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;C#&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;%&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;  8&lt;/span&gt; &lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;  9&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;&amp;lt;%&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;@ Import Namespace&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;System.Net&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;%&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 10&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;&amp;lt;%&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;--&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 11&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;实现ICallbackEventHandler接口以提供客户端回调功能。&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 12&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;--&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;%&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 13&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;&amp;lt;%&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;@ Implements Interface&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;System.Web.UI.ICallbackEventHandler&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #ffff00&#34;&gt;%&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 14&lt;/span&gt; &lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 15&lt;/span&gt; &lt;span style=&#34;color: #0000ff&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #800000&#34;&gt;script &lt;/span&gt;&lt;span style=&#34;color: #ff0000&#34;&gt;runat&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;=&#34;server&#34;&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 16&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 17&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 18&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ 此处配置远程文件保存目录&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 19&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 20&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    private static readonly string savePath &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;~/Uploads/&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 21&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 22&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 23&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ 此处配置允许下载的文件扩展名&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 24&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;remarks&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 25&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/     暂未考虑使用动态网页输出的图片如：http://site/image.aspx?uid=00001 这样的URI;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 26&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/  若要实现此功能可读取流并判断ContentType,将流另存为相应文件格式即可。&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 27&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/remarks&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 28&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 29&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    private static readonly string[ ] allowImageExtension &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;new&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; string[ ] { &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;.jpg&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;.png&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;.gif&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; };&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 30&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 31&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 32&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ 此处配置本地（网站）主机名&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 33&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 34&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    private static readonly string[ ] localhost &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;new&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; string[ ] { &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;localhost&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;www.devedu.com&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; };&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 35&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 36&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    private string localImageSrc &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; string.Empty;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 37&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 38&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    private &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; Page_Load( object obj , EventArgs args )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 39&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 40&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;Page.IsPostBack )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 41&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 42&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            ClientScriptManager csm &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; Page.ClientScript;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 43&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 44&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            string scripCallServerDownLoad &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; csm.GetCallbackEventReference( &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;args&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;__ReceiveServerData&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;context&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 45&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            string callbackScriptDwonLoad &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;function __CallServerDownLoad(args , context) {&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; scripCallServerDownLoad &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;; }&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 46&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;csm.IsClientScriptBlockRegistered( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;__CallServerDownLoad&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ) )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 47&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 48&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;                csm.RegisterClientScriptBlock( &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;this&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;.GetType( ) , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;__CallServerDownLoad&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , callbackScriptDwonLoad , &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 49&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 50&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 51&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 52&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 53&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    #region ICallbackEventHandler 成员&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 54&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 55&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 56&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ 返回数据&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 57&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 58&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;remarks&amp;gt;如果处理过程中出现错误，则仍然返回远程路径&amp;lt;/remarks&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 59&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;returns&amp;gt;服务器端处理后的本地图片路径&amp;lt;/returns&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 60&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    public string GetCallbackResult( )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 61&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 62&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; localImageSrc;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 63&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 64&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 65&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 66&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 67&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ 处理回调事件 &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 68&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 69&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;param name=&#34;eventArgument&#34;&amp;gt;一个字符串，表示要传递到事件处理程序的事件参数&amp;lt;/param&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 70&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    public &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;void&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; RaiseCallbackEvent( string eventArgument )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 71&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 72&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 73&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        string remoteImageSrc &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; eventArgument;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 74&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 75&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        string fileName &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; remoteImageSrc.Substring( remoteImageSrc.LastIndexOf( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ) &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 76&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        string ext &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; System.IO.Path.GetExtension( fileName );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 77&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 78&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;IsAllowedDownloadFile( ext ) )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 79&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 80&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;非指定类型图片不进行下载，直接返回原地址。&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 81&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            localImageSrc &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; remoteImageSrc;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 82&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 83&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 84&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 85&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        Uri uri &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;new&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; Uri( remoteImageSrc );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 86&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( IsLocalSource( uri ) )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 87&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 88&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;本地（本网站下）图片不进行下载，直接返回原地址。&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 89&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            localImageSrc &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; remoteImageSrc;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 90&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 91&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 92&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 93&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;try&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 94&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 95&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;自动创建一个目录。&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 96&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            DateTime now &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; DateTime.Now;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 97&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            string datePath &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; string.Format( @&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;{0}\{1}\{2}\{3}&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , now.Year , now.Month.ToString( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ) , now.Day.ToString( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ) , Guid.NewGuid( ).ToString( ) );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 98&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt; 99&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            string localDirectory &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; System.IO.Path.Combine( Server.MapPath( savePath ) , datePath );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;100&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;System.IO.Directory.Exists( localDirectory ) )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;101&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;102&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;                System.IO.Directory.CreateDirectory( localDirectory );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;103&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;104&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;105&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            string localFilePath &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; System.IO.Path.Combine( localDirectory , fileName );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;106&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;107&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;不存在同名文件则开始下载，若已经存在则不下载该文件，直接返回已有文件路径。&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;108&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;!&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;System.IO.File.Exists( localFilePath ) )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;109&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;110&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;                Client.DownloadFile( uri , localFilePath );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;111&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;112&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;113&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            string localImageSrc &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ResolveUrl( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;~/&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; localFilePath.Replace( Server.MapPath( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;~/&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ) , string.Empty ).Replace( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;\\&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ) );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;114&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;115&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;116&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;catch&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;117&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;118&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;下载过程中出现任何异常都不抛出(  有点狠啊 :)  )，仍然用远程图片链接。&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;119&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            localImageSrc &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; remoteImageSrc;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;120&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;121&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;122&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;123&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;124&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;125&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    #endregion&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;126&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;127&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    private WebClient client;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;128&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;129&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;130&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;see cref=&#34;System.Net.WebClient&#34;/&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;131&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;132&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    public WebClient Client&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;133&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;134&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        get&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;135&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;136&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( client &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;!=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;137&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;138&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;                &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; client;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;139&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;140&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;141&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            client &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;new&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; WebClient( );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;142&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            client.Headers.Add( &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;user-agent&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; , &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2;)&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&#34;&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; );&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;143&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;144&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; client;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;145&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;146&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;147&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;148&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;149&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;150&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ 判断Uri是否为本地路径&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;151&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;152&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;param name=&#34;uri&#34;&amp;gt;&amp;lt;/param&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;153&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;154&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    private bool IsLocalSource( Uri uri )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;155&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;156&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; i &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; localhost.Length ; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;--&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;i &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ; )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;157&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;158&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( localhost[ i ].ToLower( ) &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; uri.Host.ToLower( ) )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;159&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;160&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;                &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;161&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;162&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;163&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;164&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;165&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;166&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;167&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;168&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;169&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ 检测文件类型是否为允许下载的文件类型&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;170&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;/summary&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;171&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;param name=&#34;extension&#34;&amp;gt;扩展名 eg: &#34;.jpg&#34;&amp;lt;/param&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;172&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;//&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;/ &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #008000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;173&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    private bool IsAllowedDownloadFile( string extension )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;174&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;175&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;for&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;int&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; i &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; allowImageExtension.Length ; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;--&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;i &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&amp;gt;=&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ; )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;176&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;177&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; ( allowImageExtension[ i ].ToLower( ) &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; extension.ToLower( ) )&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;178&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            {&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;179&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;                &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;180&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;            }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;181&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;182&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;183&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;return&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;184&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    }&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;185&lt;/span&gt; &lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;    &lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;186&lt;/span&gt; &lt;span style=&#34;color: #0000ff&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&#34;color: #800000&#34;&gt;script&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;187&lt;/span&gt; &lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;188&lt;/span&gt; &lt;span style=&#34;color: #0000ff&#34;&gt;&amp;lt;!&lt;/span&gt;&lt;span style=&#34;color: #ff00ff&#34;&gt;DOCTYPE html PUBLIC &#34;-//W3C//DTD XHTML 1.0 Transitional//EN&#34; &#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&#34;&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;189&lt;/span&gt; &lt;span style=&#34;color: #0000ff&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #800000&#34;&gt;html &lt;/span&gt;&lt;span style=&#34;color: #ff0000&#34;&gt;xmlns&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;=&#34;http://www.w3.org/1999/xhtml&#34;&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;190&lt;/span&gt; &lt;span style=&#34;color: #0000ff&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #800000&#34;&gt;head &lt;/span&gt;&lt;span style=&#34;color: #ff0000&#34;&gt;runat&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;=&#34;server&#34;&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;191&lt;/span&gt; &lt;span style=&#34;color: #000000&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #800000&#34;&gt;title&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span style=&#34;color: #800000&#34;&gt;title&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #000000&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;192&lt;/span&gt; &lt;span style=&#34;color: #000000&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #800000&#34;&gt;style &lt;/span&gt;&lt;span style=&#34;color: #ff0000&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;=&#34;text/css&#34;&lt;/span&gt;&lt;span style=&#34;color: #0000ff&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #800000; background-color: #f5f5f5&#34;&gt;&lt;br /&gt;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;193&lt;/span&gt; &lt;span style=&#34;color: #800000; background-color: #f5f5f5&#34;&gt;    body &lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #ff0000; background-color: #f5f5f5&#34;&gt; margin&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt; 0px&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;/span&gt;&lt;span style=&#34;color: #ff0000; background-color: #f5f5f5&#34;&gt; overflow&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #0000ff; background-color: #f5f5f5&#34;&gt; hidden&lt;/span&gt;&lt;span style=&#34;color: #000000; background-color: #f5f5f5&#34;&gt;;&lt;/span&gt;&lt;span style=&#34;color: #ff0000; background-color: #f5f5f5&#34;&gt;  background-co              &lt;/span&gt;
&lt;/div&gt;

&lt;pre&gt;&lt;code&gt;            &amp;lt;div class=&amp;quot;postmetadata&amp;quot;&amp;gt;
                &amp;lt;div class=&amp;quot;alignright&amp;quot;&amp;gt;
&amp;lt;a class=&amp;quot;readmore&amp;quot; href=&amp;quot;http://huobazi.aspxboy.com/archives/141/&amp;quot;&amp;gt;Permalink&amp;lt;/a&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;/div&gt;
                    &lt;div class=&#34;alignleft&#34;&gt;
                        Posted by &lt;b&gt;Marble.M.Wu&lt;/b&gt; in &lt;a href=&#34;http://huobazi.aspxboy.com/category/aspnet/&#34;&gt;[01] ASP.NET&lt;/a&gt;                    &lt;/div&gt;
                &lt;/div&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Ajax Control Toolkit 出新版了</title>
      <link>http://huobazi.aspxboy.com/blog/2007/03/04/newversionofajaxcontroltoolkit/</link>
      <pubDate>Sun, 04 Mar 2007 00:00:00 +0000</pubDate>
      
      <guid>http://huobazi.aspxboy.com/blog/2007/03/04/newversionofajaxcontroltoolkit/</guid>
      <description>&lt;p&gt;&lt;p&gt;&lt;/p&gt;
&lt;table id=&#34;ctl00_ctl00_ctl00_Content_ProjectBaseMain_ProjectMain_releaseDetailsTable&#34; style=&#34;WIDTH: 100%&#34; border=&#34;0&#34;&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td valign=&#34;top&#34;&gt;&lt;span class=&#34;ReleaseDetailsHeader&#34;&gt;&lt;a href=&#34;http://www.codeplex.com/AtlasControlToolkit/Release/ProjectReleases.aspx&#34;&gt;&lt;br /&gt;&lt;h1&gt;Ajax Control Toolkit 出新版了&lt;br /&gt;&lt;a href=&#34;http://www.codeplex.com/AtlasControlToolkit/Release/ProjectReleases.aspx&#34;&gt;http://www.codeplex.com/AtlasControlToolkit/Release/ProjectReleases.aspx&lt;/a&gt;&lt;/h1&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Release 10301 Production&lt;/span&gt;&lt;/td&gt;
&lt;td valign=&#34;top&#34; align=&#34;right&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td valign=&#34;top&#34; align=&#34;left&#34; colspan=&#34;2&#34;&gt;
&lt;span class=&#34;ReleaseDateLabel&#34;&gt;三月-01-2007&lt;/span&gt;&lt;span class=&#34;ReleaseFilesCountLabel&#34;&gt;2 Files&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td valign=&#34;top&#34; align=&#34;left&#34; colspan=&#34;2&#34;&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td valign=&#34;top&#34; align=&#34;left&#34; colspan=&#34;2&#34;&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td valign=&#34;top&#34; align=&#34;left&#34; colspan=&#34;2&#34;&gt;&lt;span class=&#34;ReleaseSubHeading&#34;&gt;Description&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td valign=&#34;top&#34; align=&#34;left&#34; colspan=&#34;2&#34;&gt;&lt;span class=&#34;content&#34;&gt;2007-03-01 release of the AJAX Control Toolkit includes two new controls (ListSearch and SlideShow), a number of fixes identified as important by the community, and three significant enhancements: localization support, automatic JavaScript comment stripping, and ASP.NET theme/skin support. It continues to target the new ASP.NET AJAX v1.0 release (&lt;a href=&#34;http://ajax.asp.net/&#34;&gt;http://ajax.asp.net/&lt;/a&gt;).&lt;br /&gt;&lt;br /&gt;AjaxControlToolkit.zip is the full release package with complete source code to all controls, the test framework, VSI, and more.&lt;br /&gt;&lt;br /&gt;AjaxControlToolkit-NoSource.zip contains only the sample web site and VSI and is for people who don&amp;rsquo;t need or want the source code for the controls.&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;
&lt;td valign=&#34;top&#34; align=&#34;left&#34; colspan=&#34;2&#34;&gt;
&lt;div&gt;
&lt;br /&gt;&lt;table class=&#34;ReleaseFilesGridView&#34; id=&#34;ctl00_ctl00_ctl00_Content_ProjectBaseMain_ProjectMain_runTimeBinariesGridView&#34; style=&#34;BORDER-COLLAPSE: collapse&#34; cellspacing=&#34;0&#34; rules=&#34;all&#34; border=&#34;1&#34;&gt;
&lt;br /&gt;&lt;tbody&gt;
&lt;br /&gt;&lt;tr&gt;
&lt;th scope=&#34;col&#34;&gt;Runtime Binaries&lt;/th&gt;                    &lt;/tr&gt;
&lt;br /&gt;&lt;tr&gt;
&lt;br /&gt;&lt;td&gt;
&lt;a class=&#34;ReleaseFileDownloadLink&#34; href=&#34;javascript:WebForm_DoPostBackWithOptions(new%20WebForm_PostBackOptions(%22ctl00%24ctl00%24ctl00%24Content%24ProjectBaseMain%24ProjectMain%24runTimeBinariesGridView%24ctl02%24ctl00%22,%20%22%22,%20false,%20%22%22,%20%22http://www.codeplex.com/AtlasControlToolkit/Project/FileDownload.aspx?DownloadId=7712%22,%20false,%20true))&#34;&gt;AjaxControlToolkit-NoSource.zip&lt;/a&gt;&lt;span&gt; - 1542 Downloads (2.3 MB)&lt;/span&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;
&lt;a class=&#34;ReleaseFileDownloadLink&#34; href=&#34;javascript:WebForm_DoPostBackWithOptions(new%20WebForm_PostBackOptions(%22ctl00%24ctl00%24ctl00%24Content%24ProjectBaseMain%24ProjectMain%24runTimeBinariesGridView%24ctl03%24ctl00%22,%20%22%22,%20false,%20%22%22,%20%22http://www.codeplex.com/AtlasControlToolkit/Project/FileDownload.aspx?DownloadId=7711%22,%20false,%20true))&#34;&gt;AjaxControlToolkit.zip&lt;/a&gt;&lt;span&gt; - 4334 Downloads (3.3 MB)&lt;/span&gt;
&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;            &lt;/p&gt;
&lt;/div&gt;
&lt;br /&gt;
&lt;/td&gt;
&lt;br /&gt;
&lt;/tr&gt;
&lt;br /&gt;
&lt;/tbody&gt;
&lt;br /&gt;
&lt;/table&gt;
&lt;br /&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>